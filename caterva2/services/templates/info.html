<h3>{{ path }}</h3>

<ul class="nav nav-tabs" id="tabs">
    <li class="nav-item" role="presentation">
        <button type="button" class="nav-link active" id="metadata-tab"
                data-bs-toggle="tab" data-bs-target="#metadata-tab-pane"
                role="tab" aria-controls="metadata-tab-pane" aria-selected="true">
            Metadata
        </a>
    </li>
    {% if view_url %}
    <li class="nav-item" role="presentation">
        <button type="button" class="nav-link" id="view-tab"
                data-bs-toggle="tab" data-bs-target="#view-tab-pane"
                role="tab" aria-controls="view-tab-pane" aria-selected="true">
            View
        </a>
    </li>
    {% endif %}
    {% if display %}
        <li class="nav-item" role="presentation">
            <button type="button" class="nav-link" id="display-tab"
                    data-bs-toggle="tab" data-bs-target="#display-tab-pane"
                    role="tab" aria-controls="display-tab-pane" aria-selected="false">
                Display
            </a>
        </li>
    {% endif %}
</ul>

<div class="tab-content" id="myTabContent">
    <div class="tab-pane fade show active" id="metadata-tab-pane" tabindex="0"
         role="tabpanel" aria-labelledby="tab-metadata">
        {% include 'info_metadata.html' %}
    </div>

    {% if view_url %}
    <div class="tab-pane fade" id="view-tab-pane" tabindex="0"
         role="tabpanel" aria-labelledby="tab-view">

        shape = {{ shape }}

        <div id="info-view" hx-post="{{ view_url }}" hx-trigger="load" hx-ext="morph" hx-swap="morph:innerHTML">
        </div>
    </div>
    {% endif %}

    {% if display %}
        <div class="tab-pane fade" id="display-tab-pane" tabindex="0"
             role="tabpanel" aria-labelledby="tab-display"
             hx-get="{{ display.url }}" hx-trigger="load">
        </div>
    {% endif %}
</div>

<script>
    // If the url has a hash open the appropriate tab
    function openTab(id) {
        if (id) {
            let el = document.querySelector(`${id}-tab`);
            let tab = new bootstrap.Tab(el);
            tab.show();
        }
    }
    openTab(window.location.hash);

    // Append hash to the url when a tab is clicked, so the url can be copied including the hash
    document.querySelector('#tabs').addEventListener('shown.bs.tab', function (event) {
        window.location.hash = event.target.id.slice(0, -4);
    })
</script>
